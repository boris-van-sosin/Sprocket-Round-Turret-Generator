<!DOCTYPE html>

<script src="RoundTurret.js"></script>
<!DOCTYPE html>
<html>
<title>Sprocket round turret generator</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
  textarea {width: 100%;
	  height: 100%; 
	  box-sizing: border-box;}
</style>
<body class="w3-content" style="max-width:1300px">

<!-- First Grid: Logo & About -->
<div class="w3-row">
  <div class="w3-half w3-black w3-container w3-center" style="height:1000px">
    <div class="w3-padding-10" style="padding-top: 30px;">
      <h1>Sprocket round turret generator</h1>
      <h1>Turret parameters</h1>
    </div>
    <div class="w3-padding-10" align="left">
	  <label>Turret diameter</label><br/>
      <input type="range" id="turretDiameter" name="turretDiameter" min="0.01" max="30" step="0.01" value="7" oninput="ChangeValue(this)"/>
	  <input type="number" id="turretDiameter" name="turretDiameter" min="0.01" max="30" step="0.01" value="7"  oninput="ChangeValue(this)"/><br/>
	  <p id="turretDiameterDisp" name="turretDiameterDisp">7</p>
    </div>
	<div class="w3-padding-10" align="left">
	  <label>Turret height coefficient</label><br/>
      <input type="range" id="turretHeightFactor" name="turretHeightFactor" min="0.01" max="20" step="0.01" value="0.9" oninput="ChangeValue(this)"/>
	  <input type="number" id="turretHeightFactor" name="turretHeightFactor" min="0.01" max="20" step="0.01" value="0.9"  oninput="ChangeValue(this)"/><br/>
	  <p id="turretHeightFactorDisp" name="turretHeightFactorDisp">0.9</p>
    </div>
    <div class="w3-padding-10" align="left">
	  <label>Number of segments (radial)</label><br/>
      <input type="range" id="turretNumSegs" name="turretNumSegs" min="1" max="60" step="1" value="24" oninput="ChangeValue(this)"/>
	  <input type="number" id="turretNumSegs" name="turretNumSegs" min="1" max="60" step="1" value="24"  oninput="ChangeValue(this)"/><br/>
	  <p id="turretNumSegsDisp" name="turretNumSegsDisp">24</p>
    </div>
    <div class="w3-padding-10" align="left">
	  <label>Elevation angles (in degrees, comma separated)</label><br/>
      <input type="text" id="turretHAngles" name="turretHAngles" value="12,17,23,30"/>
	  <p></p>
    </div>
    <div class="w3-padding-10" align="left">
	  <label>Offset</label>
	  <table>
	  <tr> 
      <td><label>X</label>&nbsp;</td>
	  <td><input type="range" id="turretOffsetX" name="turretOffsetX" min="-20" max="20" step="0.01" value="0" oninput="ChangeValue(this)"/>&nbsp;</td>
	  <td><input type="number" id="turretOffsetX" name="turretOffsetX" min="-20" max="20" step="0.01" value="0"  oninput="ChangeValue(this)"/>&nbsp;</td>  
	  <td><label id="turretOffsetXDisp" name="turretOffsetXDisp">0</label></td>
	  </tr>
	  
	  <tr> 
	  <td><label>Y</label>&nbsp;</td>
	  <td><input type="range" id="turretOffsetY" name="turretOffsetY" min="-20" max="20" step="0.01" value="0" oninput="ChangeValue(this)"/>&nbsp;</td>
	  <td><input type="number" id="turretOffsetY" name="turretOffsetY" min="-20" max="20" step="0.01" value="0" oninput="ChangeValue(this)"/></td>
	  <td><label id="turretOffsetYDisp" name="turretOffsetYDisp">0</label></td>
	  </tr>
	  
	  <tr> 
	  <td><label>Z</label>&nbsp;</td>
	  <td><input type="range" id="turretOffsetZ" name="turretOffsetZ" min="-20" max="20" step="0.01" value="-2.5" oninput="ChangeValue(this)"/>&nbsp;</td>
	  <td><input type="number" id="turretOffsetZ" name="turretOffsetZ" min="-20" max="20" step="0.01" value="-2.5" oninput="ChangeValue(this)"/></td>
	  <td><label id="turretOffsetZDisp" name="turretOffsetZDisp">-2.5</label></td>
	  </tr>
	  </table>
	  <p></p>
    </div>
	<div class="w3-padding-10" align="left">
	  <label>Panel type</label>
	  <table>
	  <tr> 
      <td><input type="radio" id="OctFlat" name="turretPanelType" value="OctFlat" /><img src="OctFlat.png" style="height:50px" /></td> <!-- 0aa87a90ff5d3f749b15921aadf8ff04 -->
      <td><input type="radio" id="RectFlat" name="turretPanelType" value="RectFlat" checked /><img src="RectFlat.png" style="height:50px"/></td> <!-- 0049b3cd2772cfb43917eb41078e1d01 -->
      <td><input type="radio" id="OctRiveted" name="turretPanelType" value="OctRiveted" /><img src="OctRiveted.png" style="height:50px" /></td> <!-- 48123d97e2c457b43bef434381aa025e -->
      <td><input type="radio" id="RectRiveted" name="turretPanelType" value="RectRiveted" /><img src="RectRiveted.png" style="height:50px" /></td> <!-- f4984d57cd3f77a49877ebdd720c408b -->
	  </tr>
	  </table>
	  <p></p>
    </div>
    <div class="w3-padding-10" align="left">
	  <label>Panel scale</label><br/>
      <input type="range" id="turretPanelScale" name="turretPanelScale" min="0.01" max="10" step="0.01" value="3.5" oninput="ChangeValue(this)"/>
	  <input type="number" id="turretPanelScale" name="turretPanelScale" min="0.01" max="10" step="0.01" value="3.5"  oninput="ChangeValue(this)"/><br/>
	  <p id="turretPanelScaleDisp" name="turretPanelScaleDisp">3.5</p>
    </div>
    <div class="w3-padding-10" align="left">
      <input type="button" id="generate" name="generate" value="Generate turret!" onclick="Generate()"/>
    </div>
  </div>
  <div class="w3-half w3-blue-grey w3-container" style="height:1000px">
    <div class="w3-padding-10 w3-center" style="padding-top: 30px;">
      <h1>&nbsp;</h1><h1>Resulting code:</h1>
    </div>
    <div class="w3-padding-10" style="height:600px" align="left">
      <textarea id="resText" name="resText" readonly>text</textarea>
    </div>
	<div class="w3-padding-10" align="left">
	  <input type="button" id="copyTxt" name="copyTxt" value="copy text" onclick="CopyText()"/><div style="opacity:0" id="copiedNotification">Copied!</div>
	</div>
  </div>
</div>


<!-- Footer -->
<footer class="w3-container w3-black w3-padding-16">
  <p>Created by Com. Eng. Dr. Boris van Sosin</p>
  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
</footer>

</body>
</html>

<script>
function ChangeValue(elem)
{
  let x = elem.value;
  if (x != "")
  {
	document.getElementById(elem.id + "Disp").innerHTML = x;
  }
}

function Generate()
{
	let diameter = parseFloat(document.getElementById("turretDiameterDisp").innerHTML.trim());
	let heightFactor = parseFloat(document.getElementById("turretHeightFactorDisp").innerHTML.trim());
	let numSegs = parseInt(document.getElementById("turretNumSegsDisp").innerHTML.trim());
	let hAnglesStr = document.getElementById("turretHAngles").value;
	let offsetX = parseFloat(document.getElementById("turretOffsetXDisp").innerHTML.trim());
	let offsetY = parseFloat(document.getElementById("turretOffsetYDisp").innerHTML.trim());
	let offsetZ = parseFloat(document.getElementById("turretOffsetZDisp").innerHTML.trim());
	let scale = parseFloat(document.getElementById("turretPanelScaleDisp").innerHTML.trim());
	
	var hAngles = [];
	let hAngleStrsSplit = hAnglesStr.split(",");
	for (let s in hAngleStrsSplit) {
		let currAngle = parseFloat(hAngleStrsSplit[s].trim());
		if (!isNaN(currAngle)) {
			hAngles.push(currAngle * Math.PI / 180);
		}
	}	
	
	console.log([diameter / 2, heightFactor, hAngles, numSegs, [offsetX, offsetY, offsetZ]]);
	
	let res = Dome(diameter / 2, heightFactor, hAngles, numSegs, [offsetX, offsetY, offsetZ]);
	console.log(res);
	let res2 = ConvertToSprocketAll(res, scale);
	console.log(res);
	let jsonText = JSON.stringify(res2, null, 2);
	document.getElementById("resText").innerHTML = jsonText.slice(1, jsonText.length - 1).trim();
}

function BlinkElem(elem)
{
	var opacity = 1.0;
	elem.style.opacity = opacity;
	var fadeEffect =
		setInterval(
			function()
				{
					opacity -= 0.05;
					if (opacity < -1e-5)
					{
						clearInterval(fadeEffect);
					}
					elem.style.opacity = opacity;
				},
			50);
}

function CopyText()
{
  var txt = document.getElementById("resText").innerHTML;
  navigator.clipboard.writeText(txt);

  BlinkElem(document.getElementById("copiedNotification"));
}
</script>